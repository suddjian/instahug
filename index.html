<!DOCTYPE html>
<html>
  <head>
    <title>Instahug.me</title>
  </head>
  <body>
    <h1 id="hug">Send someone a virtual hug.</h1>
    <label for="name">Name of Hug Recipient</label>
    <input type="text" name="name" id="name">
    <button onclick="hug()">Hug!</button>
    <ol id="hugs"></ol>

    <script>
      const userPromise = new Promise(resolve => {
        window.onUserReady = resolve
      });

      function hug() {
        const hugs = document.getElementById('hugs');
        const li = document.createElement('li');
        const name = document.getElementById('name').value;
        const a = document.createElement('a');
        a.href=`/hug.html?name=${name}`;
        a.textContent = a.href;
        li.appendChild(a)
        hugs.appendChild(li);

        userPromise.then((user) => {
          window.firestore.collection("hugs").doc().set({
            user: user.uid,
            createdAt: firebase.firestore.FieldValue.serverTimestamp(),
          });
        });
      }

      document.addEventListener('keypress', (event) => {
        if (event.key === 'Enter') hug();
      })
    </script>
    <!-- The core Firebase JS SDK is always required and must be listed first -->
    <!-- https://firebase.google.com/docs/web/setup#available-libraries -->
    <script defer src="https://www.gstatic.com/firebasejs/7.24.0/firebase-app.js"></script>
    <script defer src="https://www.gstatic.com/firebasejs/7.24.0/firebase-auth.js"></script>
    <script defer src="https://www.gstatic.com/firebasejs/7.24.0/firebase-firestore.js"></script>
    <script defer src="./init.js">
    </script>
  </body>
</html>
